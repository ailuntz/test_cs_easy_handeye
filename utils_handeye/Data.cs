/*
# -*- coding: utf-8 -*-
///
Calibrate the Camera with Zhang Zhengyou Method.
Picture File Folder: "./pic/RGB_camera_calib_img/", Without Distortion. 

By Ailuntz, 2023.07.04, Ailuntz@icloud.com
///
*/

using OpenCvSharp;
using System;
using System.Diagnostics;
using System.Numerics;
using System.Runtime.InteropServices;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Data;
using OpenCvSharp.Internal.Vectors;
using static HandEyeCalibration.Definetype;
using static HandEyeCalibration.ConversionMatrix;

namespace HandEyeCalibration
{
    public partial class Data
    {


        /*试验数据
        */
        int datalen=10; 
        double[,] gripper2basedata = new double[datalen, 6];

        //Robotpose3D _gripper2base_single_data = new Robotpose3D(-0.15242, -0.088, 1.09041, -16.102, 25.659, 123.69);
        //Campose3D _Target2cam_single_data = new Campose3D(-0.53251566, -0.22288134, 2.99978054, -2.156571314953374, 17.96836783899952, 2.202110000510372);

        //Robotpose3D数组形式数据
        /* x, y, z, rx, ry, rz//Robotpose3D第一组数据 eye-in-hand//rad//结果R=rx, ry, rz ,rw=-0.3546426, 0.3806739, 0.6086649, 0.5990351//T=tx, ty, tz= 149.8673153645521, 18.5544654988438, 308.2450983655534
        double[,] _gripper2base_array_data = new double[,] { {144.4521161, 66.1347948, -465.7051590, -0.4743987, -0.2368566, -0.0782465},
                                                             {150.2226899, 62.4463700, -484.2951369, -0.4732508,-0.2369567, -0.073467},
                                                             {206.6077654, -27.9324378, -448.4078075, -0.6758548, -0.2354039, -0.1120374},
                                                             {-43.4263308, 41.8964311, -453.4463616, -0.5101464, 0.2718147, 0.0053353},
                                                             {207.5704729, 7.3753215, -406.3695738, -0.7015643, -0.362299, 0.0441629},
                                                             {221.8741936, 106.2104049, -413.5291980, -0.4975038, -0.4841192, -0.072782},
                                                             {168.6236789, 124.7429837, -444.4091351, -0.3671233, -0.427913, -0.0212725},
                                                             {213.8876994, -13.8574024, -444.9478678, -0.6308002, -0.246069, -0.2131169},
                                                            };*/
 
        /* x, y, z, rx, ry, rz//第二组数据 eye-in-hand//deg
        double[,] _gripper2base_array_data = new double[,] { {-0.15242, -0.088, 1.09041, -16.102, 25.659, 123.69},
                                                             {-0.088, -0.15242, 1.09041, -26.565, 14.478, 153.435},
                                                             {0.000, -0.176, 1.09041, -30.00, 0.00, -180.00},
                                                             {0.088, -0.15242, 1.09041, -26.565, -14.478, -153.435},
                                                             {0.15242, -0.088, 1.09041, -16.102, -25.659, -123.69},
                                                             {-0.176, 0.000, 1.09041, 0.00, 30.00, 90.00},
                                                             {-0.176, 0.29538, 1.011126, -30.00, 30.00, 90.00},
                                                             {-0.16716, 0.2668, 1.02776, -46.102, 25.659, 123.69},
                                                             {-0.143, 0.24588, 1.03984, -56.565, 14.478, 153.435},
                                                             {-0.2119, 0.26178, 0.98782, -83.948, -18.937, 126.052},
                                                            };*/
        /*  x, y, z, rx, ry, rz ,rw// rad//第三组数据 eye-in-hand//rad
        double[,] _gripper2base_array_data = new double[,] { {0.4285232296,0.1977596461,-0.5595823047,0.4738016082,0.3209333657,-0.2268795901,-0.7880605703},
                                                            {0.2265712272,0.0261943502,-0.6661910850,0.5222343809,0.0461668455,-0.1315038186,-0.8413362107},
                                                            {0.1058885008,0.0527681997,-0.7419267756,0.5081638565,-0.0263721340,-0.1696570449,-0.8439730402},
                                                            {0.1127224767,-0.0420359377,-0.7413071786,0.5101706595,-0.0322252464,-0.1864402870,-0.8390038445},
                                                            {0.2592932751,-0.0329068529,-0.7162865014,0.5101641882,0.1265739325,-0.0153077050,-0.8505746380},
                                                            {-0.1724239544,0.0084144761,-0.6998332592,0.4989369998,-0.0973210400,-0.1244194561,-0.8521210503},
                                                            {-0.0534271258,0.0771779706,-0.6845820453,0.5195499916,0.0511217081,-0.1691595167,-0.8359661686},
                                                            {0.2598500029,0.0933230213,-0.6638257382,0.5673912325,0.1686973705,-0.1427337629,-0.7932436318},
                                                            };*/
        /* x, y, z, rx, ry, rz//Robotpose3D第四组数据 hand-to-eye//rad//结果R=rx, ry, rz ,rw=0.1425639, 0.1237163, -0.0709875, 0.9794542//T=tx, ty, tz= 689.2978893974176, 386.9843567965046, 573.5786306809142
        double[,] _gripper2base_array_data = new double[,] { {377.18,346.69, 581.09, -2.1895155, 1.4149385, -0.7845255},
                                                             {390.68, 344.43, 577.58, -2.0561725,1.4149385, -0.7840018},
                                                             {383.86, 351.50, 566.52, -1.1843802, 1.4220942, 1.6646948},
                                                             {402.21, 291.88, 557.76, -1.4454816, 1.1091567, -1.3946927},
                                                            };//*/
         ///* x, y, z, rx, ry, rz//Robotpose3D第五组数据 hand-to-eye//deg//结果R=rx, ry, rz ,rw=0.1425639, 0.1237163, -0.0709875, 0.9794542//T=tx, ty, tz= 689.2978893974176, 386.9843567965046, 573.5786306809142
        double[,] _gripper2base_array_data = new double[,] { {994.643,	-37.948,	1394.25,	17.807,	-73.325,	47.233},
                                                             {994.654,	-37.965,	1394.25,	-135.872,	-81.89,	139.558},
                                                             {994.645,	-37.942,	1394.24,	-179.149,	-82.691,	174.03},
                                                             {994.624,	-37.936,	1394.25,	141.536,	-78.569,	-149.843},
                                                             {994.642,	-37.945,	1394.25,	87.317,	-79.88,	-116.288},
                                                             {994.637,	-37.95,	1394.24,	-125.093,	-74.415,	161.826	},
                                                             //{994.628,	-37.946,	1394.24,	-160.644,	-77.204,	-127.443},
                                                             {994.646,	-37.962,	1394.25,	-174.45,	-68.424,	161.718},
                                                             //{994.633,	-37.982,	1394.25,	-133.392,	-68.214,	147.635},
                                                             //{994.645,	-37.935,	1394.24,	49.976,	-79.954,	-33.976	}
                                                            };//*/


        /* x, y, z, rx, ry, rz//Campose3D第一组数据 eye-in-hand//rad
        double[,] _gTarget2cam_array_data = new double[,] { {63.0860126137940, 28.9610333193357, 228.975775155220, -0.1689782, -0.0952185, -2.9322395},
                                                             {59.7442727478359, 35.5178297229849, 212.756111469042, -0.1531844,-0.09427, -2.9339173},
                                                             {-11.9672134192024, 40.7904688256321, 233.030780465295, -0.1634773, -0.0894502, -2.7370669},
                                                             {23.1804880318842, 22.0425812434410, 248.264174105070, -0.3378254, 0.3893458, -2.8390293},
                                                             {-26.1091716393323, 46.8289595121710, 293.129807580481, 0.053972, -0.0675675, -2.6800584},
                                                             {54.9945317361700, 59.3875027697906, 267.443543451789, -0.0190344, -0.2970604, -2.8931871},
                                                             {102.142407851122, 23.4048279722072, 240.333220152591, -0.0602194,-0.2573558, -3.0144933},
                                                             {15.6263703407415, 39.1663493411513, 228.761080543106, -0.2303424, -0.1602727, -2.8007439},
                                                            };*/
        /* x, y, z, rx, ry, rz//Campose3D第二组数据 eye-in-hand//deg
        double[,] _gTarget2cam_array_data = new double[,] { {-0.53251566, -0.22288134, 2.99978054, -2.156571314953374, 17.96836783899952, 2.202110000510372},
                                                            {-0.44328823, -0.22978619, 2.4122036, 10.04677425761553, 13.217722658140007, -0.7569076141309594},
                                                            {-0.46990779, -0.32840453, 2.51890204, -0.5969738940715268, 19.56503505626854, 0.8598698487893537},
                                                            {-0.48391721, -0.40351177, 2.27804699, 7.556253345854567, 16.256789925212452, 0.033714555538883036},
                                                            {-0.57208587, -0.41269304, 2.58571284, 2.8633130363738593, 15.726493994549273, -0.7115981116920139},
                                                            {-0.49422756, -0.1702189, 2.87315438, -2.027545230194479, 16.468005086809477, -1.6960828431755508},
                                                            {-0.51349264, -0.28100387, 2.58778224, -1.2724871238262014, 21.200229674555533, -3.904702217196404},
                                                            {-0.53673736, -0.3091575, 2.71723579, -1.9171757971606331, 25.09560299293162, -3.955331059805344},
                                                            {-0.69796816, -0.40532881, 2.3216764, 2.493097502965668, 4.673219102172305, -0.6131885996737292},
                                                            {-0.69438171, -0.16458288, 2.32894208, 3.074091031173201, 6.698654128807315, -1.3210092006224454},
                                                            };*/
        /*x, y, z, rx, ry, rz ,rw// rad//Campose3D第三组数据 eye-in-hand//rad
        double[,] _gTarget2cam_array_data = new double[,] { 
                                                            {0.4277459616,-0.0267754900,0.0822384718,0.3555198802,-0.2313832954,-0.6738796808,-0.6049409568},
                                                            {0.4610891450,-0.0089776615,0.0394863697,-0.4168581229,0.4389318994,0.4953132086,0.6230833961},
                                                            {0.4159190432,0.0112235849,0.0112504715,-0.3559197420,0.4898053987,0.4542453721,0.6535081871},
                                                            {0.4143974465,0.0094036803,0.1073298638,-0.3438949365,0.4875942762,0.4507613906,0.6639294113},
                                                            {0.3473267442,-0.1866610227,0.0651366494,0.4966101920,-0.4291949558,-0.5361047392,-0.5308123169},
                                                            {0.3883165305,-0.2249779584,0.0093256602,-0.3595692001,0.5529429756,0.4090559739,0.6305848604},
                                                            {0.4309364801,-0.2354261800,-0.0925819097,-0.3831460128,0.4244707870,0.5043032275,0.6470718186},
                                                            {0.4362292324,-0.0778107597,-0.1007970399,0.4568889439,-0.3144470665,-0.5302104578,-0.6412896427},
                                                            };*/
        //* x, y, z, rx, ry, rz//Campose3D第四组数据 hand-to-eye//rad//
        /*double[,] _gTarget2cam_array_data = new double[,] { {-48.4528696972388, -32.9428131930746, 161.065631617250, -0.1588792, -0.0973543,0.1438789},
                                                             {-62.0013541116839, -34.1299719569008, 164.980813774003, -0.0257775,-0.083593, 0.1545468},
                                                             {-55.0705381175398, -26.7901391225223, 143.932686495397, -0.0436629, 0.0437994, 0.1565832},
                                                             {-59.7908161911226, -10.7263017825663, 154.702510082749, -0.0523258, 0.0306989, 0.4666219},
                                                            };//*/

        //* x, y, z, rx, ry, rz//Campose3D第五组数据 hand-to-eye//rad//
        double[,] _gTarget2cam_array_data = new double[,] { {137.779, 33.2928, 448.709, -0.070161, 0.841287, 0.516215, -0.144348 },
                                                             {154.369, 68.4331, 441.184, 0.04494, 0.984248, -0.010488, -0.170663 },
                                                             {117.162, 61.4861, 452.949, 0.04603, 0.98721, -0.086792, -0.125557 },
                                                             {64.8361, 80.9416, 461.143, 0.063303, 0.989077, -0.115737, -0.065759},
                                                             {19.3817, 2.11205, 468.869, -0.021482, 0.959178 ,-0.280603, -0.027898 },
                                                             {136.458, 198.609, 412.401, 0.139448, 0.933302, 0.260245, -0.204387 },
                                                            // {-39.3342, 202.762, 431.575, 0.18186, 0.820734, 0.535043, -0.083972 },
                                                             {168.262, 144.271, 420.921, 0.154742, 0.960416, -0.16688, -0.160646 },
                                                            //{205.723, 175.097, 392.983, 0.146566, 0.956244, 0.065718 ,-0.244534 },
                                                             //{55.2389, -13.908, 465.203, -0.050386, 0.990389, 0.112978 ,-0.061859}
                                                            };//*/

        //Robotpose3D数据//数据转四元数
        Robotpose3D[] _gripper2base_data =  new Robotpose3D[_gripper2base_array_data.GetLength(0)];
        for (int i = 0; i < _gripper2base_data.Length; i++)
        {
            //x,y,z,rx,ry,rz
            Quaternion tmp_qua_G_t2b = EulerToQuaternion(_gripper2base_array_data[i, 3], _gripper2base_array_data[i, 4], _gripper2base_array_data[i, 5], "deg", "xyz");
            _gripper2base_data[i] = new Robotpose3D(_gripper2base_array_data[i, 0], _gripper2base_array_data[i, 1], _gripper2base_array_data[i, 2], tmp_qua_G_t2b.w, tmp_qua_G_t2b.x, tmp_qua_G_t2b.y, tmp_qua_G_t2b.z);
        
            //x,y,z,w,pitch,yaw,roll
            //_gripper2base_data[i] = new Robotpose3D(_gripper2base_array_data[i, 0], _gripper2base_array_data[i, 1], _gripper2base_array_data[i, 2],  _gripper2base_array_data[i, 6],  _gripper2base_array_data[i, 3], _gripper2base_array_data[i, 4], _gripper2base_array_data[i, 5]);
        }
        Console.WriteLine(_gripper2base_data);

        //Campose3D数据
        Campose3D[] _gTarget2cam_data = new Campose3D[_gTarget2cam_array_data.GetLength(0)];
        for (int i = 0; i < _gTarget2cam_data.Length; i++)
        {
            ///*
            //x,y,z,w,x,y,z
            Quaternion tmp_qua_G_t2b = new Quaternion();
            tmp_qua_G_t2b.w = _gTarget2cam_array_data[i, 6];
            tmp_qua_G_t2b.x = _gTarget2cam_array_data[i, 3];
            tmp_qua_G_t2b.y = _gTarget2cam_array_data[i, 4];
            tmp_qua_G_t2b.z = _gTarget2cam_array_data[i, 5]; 
            //四元数转欧拉角  
            Double[,] tmp_MAT_G_t2b1 = QuaterniontoRotationVector(tmp_qua_G_t2b.w, tmp_qua_G_t2b.x, tmp_qua_G_t2b.y, tmp_qua_G_t2b.z);
            Mat tmp_MAT_G_t2b2 = Mat.FromArray(tmp_MAT_G_t2b1);
            EulerAngles tmp_eul_G_t2b = RotateMatrixToEulerAngle(tmp_MAT_G_t2b2,"xyz");
            _gTarget2cam_data[i] = new Campose3D(_gTarget2cam_array_data[i, 0], _gTarget2cam_array_data[i, 1], _gTarget2cam_array_data[i, 2], tmp_eul_G_t2b.rx, tmp_eul_G_t2b.ry, tmp_eul_G_t2b.rz);
            //*/

            //x,y,z,rx,ry,rz
            //_gTarget2cam_data[i] = new Campose3D(_gTarget2cam_array_data[i, 0], _gTarget2cam_array_data[i, 1], _gTarget2cam_array_data[i, 2], _gTarget2cam_array_data[i, 3], _gTarget2cam_array_data[i, 4], _gTarget2cam_array_data[i, 5],"rad");

        }



    }
    
}